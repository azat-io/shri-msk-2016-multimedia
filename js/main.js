"use strict";function initCanvas(){ctx.beginPath(),ctx.fillStyle="black",ctx.fillRect(0,0,canvas.width,canvas.height),drawPlayButton()}function drawLoop(){ctx.drawImage(video,0,0,video.width,video.height),grayScale()}function startDrawLoop(){"undefined"==typeof intervalId&&(intervalId=setInterval(function(){drawLoop()},fps))}function stopDrawLoop(){"undefined"!=typeof intervalId&&(clearInterval(intervalId),intervalId=void 0)}function grayScale(){for(var t=ctx.getImageData(0,0,canvas.width,canvas.height),e=t.data,a=0,i=e.length;a<i;a+=4){var n=Math.random()+2,r=e[a],o=e[a+1],d=e[a+2],u=.5*r+.7*o+.4*d;e[a]=e[a+1]=e[a+2]=u*n}ctx.putImageData(t,0,0),scratch()}function scratch(){function t(){ctx.beginPath();var t={x:Math.floor(Math.random()*(canvas.width-1)),y:Math.floor(Math.random()*(canvas.height-1))},e={x:t.x,y:Math.floor(Math.random()*(canvas.height-t.y))};ctx.moveTo(t.x,t.y),ctx.lineTo(e.x,e.y),ctx.stroke()}ctx.beginPath(),ctx.strokeStyle="rgba(255, 255, 255, 0.2)";var e=Math.floor(101*Math.random());if(e-=97,e>0)for(var a=0;a<e;a++)t();ctx.fill()}function drawPlayButton(){var t={width:60,height:70};ctx.beginPath(),ctx.moveTo((canvas.width-t.width)/2,(canvas.height-t.height)/2),ctx.lineTo((canvas.width+t.width)/2,canvas.height/2),ctx.lineTo((canvas.width-t.width)/2,(canvas.height+t.height)/2),ctx.fillStyle="#fcfcfc",ctx.fill()}function readSubs(t){reader.readAsText(t.target.files[0]),reader.addEventListener("load",function(){function t(){1e3*video.currentTime>=subData[0].startTime&&(video.pause(),drawSub(),addSubTimeout())}subData=parser.fromSrt(reader.result,!0),subData.slice(1),console.log(subData),video.addEventListener("timeupdate",t)})}function drawSub(){if(!isSubShow){console.log("time to show!!!!"),isSubShow=!0,ctx.fillStyle="black",ctx.fillRect(0,0,canvas.width,canvas.height),ctx.fillStyle="white";var t=.1*canvas.width,e=.1*canvas.height,a=.8*canvas.width,i=24;ctx.font="1.5em Oranienbaum, serif";for(var n=0;n<subData[0].text.length;n++)subData[0].text[n],ctx.fillText(subData[0].text[n],t,e+i*n,a)}}function addSubTimeout(){"undefined"==typeof subTimeout&&(subTimeout=setTimeout(function(){subData=subData.slice(1),video.play(),isSubShow=!1},subData[0].endTime-subData[0].startTime))}function clearSubTimeout(){"undefined"!=typeof subTimeout&&(clearTimeout(subTimeout),subTimeout=void 0)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},parser=function(){var t={};t.fromSrt=function(t,a){var i=!!a;t=t.replace(/\r/g,"");var n=/(\d+)\n(\d{2}:\d{2}:\d{2},\d{3}) --> (\d{2}:\d{2}:\d{2},\d{3})/g;t=t.split(n),t.shift();for(var r=[],o=0;o<t.length;o+=4){var d=t[o+3].trim().split("\n");if("undefined"!=typeof d.length)for(var u=0;u<d.length;u++)d[u]=d[u].trim();r.push({id:t[o].trim(),startTime:i?e(t[o+1].trim()):t[o+1].trim(),endTime:i?e(t[o+2].trim()):t[o+2].trim(),text:d})}return r},t.toSrt=function(t){if(!t instanceof Array)return"";for(var e="",i=0;i<t.length;i++){var n=t[i];isNaN(n.startTime)||isNaN(n.endTime)||(n.startTime=a(parseInt(n.startTime,10)),n.endTime=a(parseInt(n.endTime,10))),e+=n.id+"\r\n",e+=n.startTime+" --> "+n.endTime+"\r\n",e+=n.text.replace("\n","\r\n")+"\r\n\r\n"}return e};var e=function(t){var e=/(\d+):(\d{2}):(\d{2}),(\d{3})/,a=e.exec(t);if(null===a)return 0;for(var i=1;i<5;i++)a[i]=parseInt(a[i],10),isNaN(a[i])&&(a[i]=0);return 36e5*a[1]+6e4*a[2]+1e3*a[3]+a[4]},a=function(t){var e=[36e5,6e4,1e3],a=[];for(var i in e){var n=(t/e[i]>>0).toString();n.length<2&&(n="0"+n),t%=e[i],a.push(n)}var r=t.toString();if(r.length<3)for(i=0;i<=3-r.length;i++)r="0"+r;return a.join(":")+","+r};return t}();"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&(module.exports=parser);var video=document.querySelector(".player__video"),canvas=document.querySelector(".player__canvas"),audio=document.querySelector(".player__audio"),ctx=canvas.getContext("2d"),fps=41.708,intervalId=void 0;video.width=canvas.width=video.offsetWidth,video.height=canvas.height=video.offsetHeight,initCanvas(),video.addEventListener("play",function(){startDrawLoop()},!1),video.addEventListener("pause",function(){stopDrawLoop()},!1),canvas.addEventListener("click",function(){isSubShow?audio.paused?(audio.play(),drawSub(),addSubTimeout()):(audio.pause(),clearSubTimeout(),drawPlayButton()):video.paused?(video.play(),audio.play()):(video.pause(),audio.pause(),drawPlayButton())});var subInput=document.querySelector(".test"),reader=new FileReader,subTimeout=void 0;subInput.addEventListener("change",readSubs);var subData=void 0,isSubShow=!1;
//# sourceMappingURL=main.js.map
